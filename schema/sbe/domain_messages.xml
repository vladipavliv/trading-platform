<?xml version="1.0" encoding="UTF-8"?>
<messageSchema xmlns="http://fixprotocol.io/2022/sbe"
               package="hft.serialization.gen.sbe.domain"
               id="1"
               version="1"
               byteOrder="littleEndian"
               messageHeader="messageHeader">

  <!-- Enums -->

  <types>
    <composite name="messageHeader" description="Standard message header">
        <type name="blockLength" primitiveType="uint16"/>
        <type name="templateId" primitiveType="uint16"/>
        <type name="schemaId" primitiveType="uint16"/>
        <type name="version" primitiveType="uint16"/>
    </composite>

    <composite name="Char32" description="Fixed length 32-char array">
      <type name="char32" primitiveType="char" length="32" characterEncoding="UTF-8"/>
    </composite>
    
    <composite name="Char4" description="Fixed length 32-char array">
      <type name="char4" primitiveType="char" length="4" characterEncoding="UTF-8"/>
    </composite>

    <enum name="OrderAction" encodingType="int8">
      <validValue name="DUMMY" value="0">0</validValue>
      <validValue name="BUY" value="1">1</validValue>
      <validValue name="SELL" value="2">2</validValue>
      <validValue name="MODIFY" value="3">3</validValue>
      <validValue name="CANCEL" value="4">4</validValue>
    </enum>

    <enum name="OrderState" encodingType="int32">
      <validValue name="Accepted" value="0">0</validValue>
      <validValue name="Rejected" value="1">1</validValue>
      <validValue name="Cancelled" value="2">2</validValue>
      <validValue name="Partial" value="3">3</validValue>
      <validValue name="Full" value="4">4</validValue>
    </enum>
  </types>

  <!-- Messages -->

  <message name="LoginRequest" id="1" description="Login request">
    <field name="name" id="1" type="Char32"/>
    <field name="password" id="2" type="Char32"/>
  </message>

  <message name="LoginResponse" id="2" description="Login response">
    <field name="token" id="1" type="uint32" />
    <field name="ok" id="2" type="uint8" />
    <field name="error_msg" id="3" type="Char32" />
  </message>

  <message name="TokenBindRequest" id="3" description="Token bind request">
    <field name="token" id="1" type="uint32" />
  </message>

  <message name="Order" id="4" description="Order">
    <field name="id" id="1" type="uint32" />
    <field name="created" id="2" type="uint64" />
    <field name="ticker" id="3" type="Char4" />
    <field name="quantity" id="4" type="uint32" />
    <field name="price" id="5" type="uint32" />
    <field name="action" id="6" type="OrderAction" />
  </message>

  <message name="OrderStatus" id="5" description="Order status">
    <field name="order_id" id="1" type="uint32" />
    <field name="timestamp" id="2" type="uint64" />
    <field name="quantity" id="3" type="uint32" />
    <field name="fill_price" id="4" type="uint32" />
    <field name="state" id="5" type="OrderState" />
  </message>

  <message name="TickerPrice" id="6" description="Ticker price">
    <field name="ticker" id="1" type="Char4" />
    <field name="price" id="2" type="uint32" />
  </message>

  <!-- Wrapper message with discriminator and choice -->

  <message name="Message" id="100" description="Top-level message wrapper">
    <field name="messageType" id="1" type="uint8" description="Discriminator for the union" />
    <choice name="message" id="2" choiceType="messageType">
      <case id="1" ref="LoginRequest" />
      <case id="2" ref="LoginResponse" />
      <case id="3" ref="TokenBindRequest" />
      <case id="4" ref="Order" />
      <case id="5" ref="OrderStatus" />
      <case id="6" ref="TickerPrice" />
    </choice>
  </message>

</messageSchema>
